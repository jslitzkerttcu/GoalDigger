<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoalDigger Chat Widget</title>
    <!-- Deployment trigger v4 -->
    <link rel="stylesheet" href="css/widget.css">
</head>
<body>
    <!-- GoalDigger Chat Widget Only -->
    <div id="goaldigger-widget" class="gd-widget">
        <div class="gd-header">
            <span class="gd-title">‚õèÔ∏è GoalDigger Coach</span>
            <span class="gd-session" id="gd-session">Session: ...</span>
            <button class="gd-clear" onclick="GoalDigger.clearChat()" title="Start new conversation">üóëÔ∏è</button>
            <button class="gd-minimize" onclick="GoalDigger.toggle()">_</button>
        </div>
        
        <div class="gd-messages" id="gd-messages">
            <!-- Messages appear here -->
        </div>
        
        <div class="gd-context-vault" id="gd-vault" style="display: none;">
            <div class="vault-header">
                <strong>üîí Context Vault</strong>
                <button onclick="GoalDigger.hideVault()">‚úï</button>
            </div>
            <pre id="vault-content">{}</pre>
        </div>
        
        <div class="gd-input-area">
            <input 
                type="text" 
                id="gd-input" 
                placeholder="Ask about your savings plan..."
                onkeypress="if(event.key==='Enter') GoalDigger.sendMessage()"
            />
            <button onclick="GoalDigger.sendMessage()">Send</button>
        </div>
    </div>

    <!-- Chart Modal -->
    <div id="chart-modal" class="chart-modal" style="display: none;">
        <div class="chart-modal-content">
            <div class="chart-modal-header">
                <h3>Chart Details</h3>
                <button class="chart-modal-close" onclick="GoalDigger.closeChartModal()">&times;</button>
            </div>
            <div class="chart-modal-body">
                <canvas id="modal-chart-canvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Load Chart.js synchronously first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <script>
        // Wait for Chart.js to be fully loaded before loading widget
        (function waitForChart() {
            if (typeof Chart !== 'undefined') {
                console.log('Chart.js confirmed loaded, version:', Chart.version);
                // Load widget script dynamically after Chart.js is confirmed
                var script = document.createElement('script');
                script.src = 'js/widget.js';
                script.onload = function() {
                    console.log('Widget script loaded after Chart.js');
                };
                document.body.appendChild(script);
            } else {
                console.log('Waiting for Chart.js...');
                setTimeout(waitForChart, 50);
            }
        })();
    </script>
</body>
</html>