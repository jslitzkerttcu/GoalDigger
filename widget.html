<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoalDigger Chat Widget</title>
    <!-- Deployment trigger v4 -->
    <link rel="stylesheet" href="css/widget.css">
</head>
<body>
    <!-- GoalDigger Chat Widget Only -->
    <div id="goaldigger-widget" class="gd-widget">
        <div class="gd-header">
            <span class="gd-title">‚õèÔ∏è GoalDigger Coach</span>
            <span class="gd-session" id="gd-session">Session: ...</span>
            <button class="gd-clear" onclick="GoalDigger.clearChat()" title="Start new conversation">üóëÔ∏è</button>
            <button class="gd-minimize" onclick="GoalDigger.toggle()">_</button>
        </div>
        
        <div class="gd-messages" id="gd-messages">
            <!-- Messages appear here -->
        </div>
        
        <div class="gd-context-vault" id="gd-vault" style="display: none;">
            <div class="vault-header">
                <strong>üîí Context Vault</strong>
                <button onclick="GoalDigger.hideVault()">‚úï</button>
            </div>
            <pre id="vault-content">{}</pre>
        </div>
        
        <div class="gd-input-area">
            <input 
                type="text" 
                id="gd-input" 
                placeholder="Ask about your savings plan..."
                onkeypress="if(event.key==='Enter') GoalDigger.sendMessage()"
            />
            <button onclick="GoalDigger.sendMessage()">Send</button>
        </div>
    </div>

    <!-- Chart Modal -->
    <div id="chart-modal" class="chart-modal" style="display: none;">
        <div class="chart-modal-content">
            <div class="chart-modal-header">
                <h3>Chart Details</h3>
                <button class="chart-modal-close" onclick="GoalDigger.closeChartModal()">&times;</button>
            </div>
            <div class="chart-modal-body">
                <canvas id="modal-chart-canvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Chart.js Library - try older stable version -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
        // Debug Chart.js loading
        console.log('Checking Chart.js availability...');
        if (typeof Chart !== 'undefined') {
            console.log('Chart.js loaded successfully, version:', Chart.version);
        } else {
            console.error('Chart.js failed to load from CDN');
            // Try alternative CDN
            var script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js';
            script.onload = function() { console.log('Chart.js loaded from cdnjs fallback'); };
            script.onerror = function() { console.error('All Chart.js CDNs failed'); };
            document.head.appendChild(script);
        }
    </script>
    <script src="js/widget.js"></script>
</body>
</html>